<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Xbox controller demo</title>

	<!-- Basic styling, centering the canvas -->
	<style>
		table, th, td {
			border : 1px solid black;
			border-collapse: collapse;
		}
		
		.button {
			background		: red;
			text-align		: center;
		}
		.value {
			background		: yellow;
			text-align		: center;
		}
		.controller {
            width           : 400px;
            margin-left     : 2%;
            margin-right    : 2%;
            margin-bottom   : 5%;
            padding         : 0px;
            float           : left;
            background-color: #ccc
        }
        .clear {
            clear: both;
        }
	</style>

	<script>

		var idx   = 0;
		var ctrlr = null; // object
		
		/**
		 *
		 */
		 avail=0;
	 	 D_UP=1;
		 D_DN=2;
		 D_LEFT=3;
		 D_RIGHT=4;
		 START=5;
		 BACK=6;
		 LS_PRESS=7;
		 RS_PRESS=8;
		 LB=9;
		 RB=10;
		 LOGO=11;
		 SPARE=12;
		 A=13;
		 B=14;
		 X=15;
		 Y=16;
		 LEFT_TRIGGER=17;
		 RIGHT_TRIGGER=18;
		 LEFT_STICK_X=19;
		 LEFT_STICK_Y=20;
		 RIGHT_STICK_X=21;
		 RIGHT_STICK_Y=22;


		function getButtons()
		{ 
			var req = null; 
			
			
			if(window.XMLHttpRequest)
				req = new XMLHttpRequest(); 
			else if (window.ActiveXObject)
				req  = new ActiveXObject(Microsoft.XMLHTTP); 
			
			req.onreadystatechange = function()
			{ 
				if(req.readyState == 4)
				{
					if(req.status == 200)
					{
						updateController(idx, req.responseText);
						next();
						getButtons();
					}	
					else	
					{
						// report error;
					}	
				} 
			}; 
			
			req.open("GET", "/cgi-bin/xbcweb?" + idx + ",btns,0", true); 
			req.send(null); 
		} 

		function next()
		{
			idx++;
			if(idx >= 4)
			{
				idx = 0;
			}
		}

		function updateController(id, data)
		{
			var elem = null;
			var b = data.split(",");
					
			switch(id) {
				case 0: elem = document.getElementById('avail_'+id); 
						updateBoolElem(elem, b[avail]);
						elem = document.getElementById('D_UP_'+id); 
						updateBoolElem(elem, b[D_UP]);
						elem = document.getElementById('D_DN_'+id); 
						updateBoolElem(elem, b[D_DN]);
						elem = document.getElementById('D_LEFT_'+id); 
						updateBoolElem(elem, b[D_LEFT]);
						elem = document.getElementById('D_RIGHT_'+id); 
						updateBoolElem(elem, b[D_RIGHT]);

						elem = document.getElementById('A_'+id); 
						updateBoolElem(elem, b[A]);
						elem = document.getElementById('B_'+id); 
						updateBoolElem(elem, b[B]);
						elem = document.getElementById('X_'+id); 
						updateBoolElem(elem, b[X]);
						elem = document.getElementById('Y_'+id); 
						updateBoolElem(elem, b[Y]);

						elem = document.getElementById('START_'+id); 
						updateBoolElem(elem, b[START]);
						elem = document.getElementById('BACK_'+id); 
						updateBoolElem(elem, b[BACK]);
						elem = document.getElementById('LB_'+id); 
						updateBoolElem(elem, b[LB]);
						elem = document.getElementById('RB_'+id); 
						updateBoolElem(elem, b[RB]);

						elem = document.getElementById('LS_PRESS_'+id); 
						updateBoolElem(elem, b[LS_PRESS]);
						elem = document.getElementById('RS_PRESS_'+id); 
						updateBoolElem(elem, b[RS_PRESS]);
						elem = document.getElementById('LOGO_'+id); 
						updateBoolElem(elem, b[LOGO]);
						elem = document.getElementById('SPARE_'+id); 
						updateBoolElem(elem, b[SPARE]);

						elem = document.getElementById('LEFT_TRIGGER_'+id); 
						updateValue(elem, b[LEFT_TRIGGER]);
						elem = document.getElementById('RIGHT_TRIGGER_'+id); 
						updateValue(elem, b[RIGHT_TRIGGER]);

						elem = document.getElementById('LEFT_STICK_X_'+id); 
						updateValue(elem, b[LEFT_STICK_X]);
						elem = document.getElementById('LEFT_STICK_Y_'+id); 
						updateValue(elem, b[LEFT_STICK_Y]);
						
						elem = document.getElementById('RIGHT_STICK_X_'+id); 
						updateValue(elem, b[RIGHT_STICK_X]);
						elem = document.getElementById('RIGHT_STICK_Y_'+id); 
						updateValue(elem, b[RIGHT_STICK_Y]);						
						break;
				case 1: //console.log("Controller 1 = " + data);
						break;
				case 2: //console.log("Controller 2 = " + data);
						break;
				case 3: //console.log("Controller 3 = " + data);
						break;		
			}
		}
		
		function updateValue(elem, val)
		{
			elem.innerHTML = val;
		}
		
		function updateBoolElem(elem, val)
		{
			if(val == 1)
			{
				elem.style.background = 'lime';
			}
			else
			{
				elem.style.background = '#ccc';
			}
		}
		
		function init()
		{
			getButtons();
			
			//elem.style.background = 'lime';
			
		}

		window.onload = init();

	</script>
</head>

<body>
	<h1>Xbox 360 controller demo</h1>

	<div class="controller">
		<table style="width:100%" id="controller0">
			<tr>
				<th style="height:50px;text-align:center;background:#00ccff" class="center" colspan="4" id="header">Controller 1</th>
			</tr>
			<tr>
				<td class="button" id="avail_0" colspan="4">Available</td>
			</tr>
			<tr>
				<td class="button" id="D_UP_0">D-up</td>
				<td class="button" id="D_DN_0">D-dn</td>
				<td class="button" id="D_LEFT_0">D-left</td>
				<td class="button" id="D_RIGHT_0">D-right</td>
			</tr>
			<tr>
				<td class="button" id="A_0">A</td>
				<td class="button" id="B_0">B</td>
				<td class="button" id="X_0">X</td>
				<td class="button" id="Y_0">Y</td>
			</tr>
			<tr>
				<td class="button" id="START_0">START</td>
				<td class="button" id="BACK_0">BACK</td>
				<td class="button" id="LB_0">LB</td>
				<td class="button" id="RB_0">RB</td>
			</tr>
			<tr>
				<td class="button" id="LS_PRESS_0">LS</td>
				<td class="button" id="RS_PRESS_0">RS</td>
				<td class="button" id="LOGO_0">Logo</td>
				<td class="button" id="SPARE_0"></td>
			</tr>
			<tr>
				<td colspan="2" class="value" id="LEFT_TRIGGER_0">nan</td>
				<td colspan="2" class="value" id="RIGHT_TRIGGER_0">nan</td>
			</tr>
			<tr>
				<td class="value" id="LEFT_STICK_X_0">nan</td>
				<td class="value" id="LEFT_STICK_Y_0">nan</td>
				<td class="value" id="RIGHT_STICK_X_0">nan</td>
				<td class="value" id="RIGHT_STICK_Y_0">nan</td>
			</tr>
		</table>
	</div>
</body>
</html>
